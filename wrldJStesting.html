

<head>


<script src="https://cdn-webgl.wrld3d.com/wrldjs/dist/latest/wrld.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.1/leaflet.css" rel="stylesheet" />

<style>
      #floorButtons {
        position: absolute;
        z-index: 20;
      }

      #floorButtons button {
        display: block;
        width: 100%;
      }
	  
	  

	  
	  
	  
    </style>

<head/>

<body>

  <div style="position: relative">
  
  <div id="floorButtons">
	<button type="button" onclick="topFloor()">Top Floor</button>
      <button type="button" onclick="moveUp()">Move Up</button>
      <button type="button" onclick="moveDown()">Move Down</button>
      <button type="button" onclick="bottomFloor()">Bottom Floor</button>
      <button type="button" onclick="exitIndoors()">Exit</button>
	  <button type="button" onclick="updateText()">THIS IS A TEST FEATURE AND WRITTEN IN ALL CAPS</button>
    </div>
	

  
    <div id="map" style="height: 700px"></div>

<script src="https://cdn-webgl.wrld3d.com/wrldjs/dist/latest/wrld.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.1/leaflet.css" rel="stylesheet" />
<div id="map" style="height: 250px"></div>
<script>
	
	
	var map = L.Wrld.map("map", "53f4c834b8971f09274f49d43fa3f85c", {center: [56.4599, -2.97],zoom: 16, indoorsEnabled: true} );
	var mousePoint = null;
	var popup;
	var indoorMap = null;
	var updateCnt = 0;
	var popUpTime = 0;
	

	
	
	//This code makes a map appear
	var marker = L.marker([56.459997, -2.978281], {title: "TEST MARKER!", indoorMapId: "westport_house", indoorMapFloorId: 2}).addTo(map);
	
	//This code is from the example, used to control floor buttons https://www.wrld3d.com/wrld.js/latest/docs/examples/move-between-indoor-map-floors/
	
	marker.bindPopup('<p style="color:red;">This is a paragraph.</p>').openPopup();
	
	map.on("initialstreamingcomplete", function(e) {
    
		map.indoors.enter("westport_house");

	});
	
	
	//Called when an entity is clicked
	function onIndoorEntityClicked(event) 
	{

        var state = 0;
		
		if ((event.ids[1] != null) && (event.ids[1] < 41))//Because of the order of how things are projected a desk ID will always be second as room is always first. Therefore if there is no second value no desk has been clicked on
		{
			//Step send the desk to the PHP file for handling stuff using chinese resturant part 5
			
			xmlhttp = new XMLHttpRequest(); //This creates a new XMLHttp request in a form that don't care about IE6
		
			
			xmlhttp.onreadystatechange = function()
			{
				
				if (this.readyState == 4 && this.status == 200)
				{
				
					var state = this.responseText; //State is the response to this query
					
					deskPopUp(state);
				}
			};
			xmlhttp.open("GET","wrldDatabaseFetch.php?q="+event.ids[1],true);
			xmlhttp.send();
		
		}

		
    }
	function onMouseDown(event)
	{
		
		mousePoint = event.latlng;

		
	}
	
	function deskPopUp(state)
	{
		//Now we slit state into 3 sections
		var split = state.split(',');
		alert(split[3]);
		
		if (split[2] == 1)
		{
			var content = '<span class="popuptext" id="myPopup"> <h5 align="right"></h5><h3 align="left">'+split[0]+' '+split[1]+'</h3><h4 style="background-color:green;">Is available until '+split[3]+'</h4>  </span>';
		}
		else
		{
			if (split[2] == 2)
			{
				var content = '<span class="popuptext" id="myPopup"> <h5 align="right"></h5><h3 align="left"> DESK UNASIGNED</h3><h4 style="background-color:red;"></h4>  </span>';
			}
			else 
			{
				var content = '<span class="popuptext" id="myPopup"> <h5 align="right"></h5><h3 align="left">'+split[0]+' '+split[1]+'</h3><h4 style="background-color:red;">Is  not currently at this desk</h4>  </span>';
			}
		}
		
		/*
		popup = L.popup()
			.setLatLng(mousePoint)
			.setContent(content)
			.openOn(map);
			*/
			
		map.openPopup(content, mousePoint, {indoorMapId: 'westport_house', indoorMapFloorId: 2});
		
	}
	
	
	
	function moveUp() {
        map.indoors.moveUp();
		}

      function moveDown() {
        map.indoors.moveDown();
      }

      function bottomFloor() {
        map.indoors.setFloor(0);
      }

      function exitIndoors() {
        map.indoors.exit();
      }
	  function displayIDS(id) {
		alert(id);
	  }
	  function updateText() {
		//alert("I AM BEING CALLED");
		popup.setContent("FHWFHAOIGHSKIGHEUIFGNDJFG");
		popup.update();
	  }
	  
	  function popupExists(event) {
	  
		//This is a bodge
		popup = event.popup;
	  }
	  function update() {
	  
		updateCnt++;

		if (updateCnt == 100)
		{
			//alert("100!!");
			updateCnt = 0;
			
			//Update the date and time
			
			
			
		}
	  }
	  
	  
	//You aren't allowed to leave
	
	
	//Event handlers?
	map.indoors.on("indoorentityclick", onIndoorEntityClicked); //When an indoor entity is clicked
	map.on("popupopen", popupExists);
	map.on("mousedown", onMouseDown); //When the mouse is clicked
	map.on("update", update); //On every frame
	

</script>

<div/>


<body/>